<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Estoque de Peças</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
  <div class="container">
    <div class="form-section">
      <h2>Busca Rápida por SKU (com Busca Binária)</h2>
      <form action="/buscar_sku" method="post">
        <div class="form-group">
          <label for="sku_prefix">Digite o início do SKU (ex: HON-CG160):</label>
          <input type="text" id="sku_prefix" name="sku_prefix" value="{{ sku_buscado or '' }}" required>
        </div>
        <button type="submit" class="btn">Buscar por SKU</button>
      </form>
    </div>

    <div class="form-section">
      <h2>Filtros Avançados (Otimizado com Hashing)</h2>
      <form action="/filtrar" method="post">
        <div class="form-group inline"><label for="marca">Marca:</label><input type="text" id="marca" name="marca" value="{{ form_values.marca or '' }}"></div>
        <div class="form-group inline"><label for="modelo">Modelo da Moto:</label><input type="text" id="modelo" name="modelo" value="{{ form_values.modelo or '' }}"></div>
        <div class="form-group inline"><label for="categoria_peca">Categoria da Peça:</label><input type="text" id="categoria_peca" name="categoria_peca" value="{{ form_values.categoria_peca or '' }}"></div>
        <div class="form-group inline"><label for="ano">Ano:</label><input type="number" id="ano" name="ano" value="{{ form_values.ano or '' }}" placeholder="Ex: 2023"></div>
        <button type="submit" class="btn">Filtrar Peças</button>
      </form>
    </div>

    <div class="results-area">

      {% if pecas_por_sku is defined %}
      <h3>Resultados para o SKU "{{ sku_buscado }}" ({{ pecas_por_sku|length }} peças encontradas)</h3>
      {% if pecas_por_sku %}
      <table>
        <thead>
          <tr>
            <th>SKU</th>
            <th>Peça</th>
            <th>Categoria</th>
            <th>Marca</th>
            <th>Modelo</th>
            <th>Ano</th>
            <th>Preço</th>
            <th>Estoque</th>
          </tr>
        </thead>
        <tbody>
          {% for peca in pecas_por_sku %}
          <tr>
            <td>{{ peca.SKU }}</td>
            <td>{{ peca.Nome_Peca }}</td>
            <td>{{ peca.Categoria_Peca }}</td>
            <td>{{ peca.Marca }}</td>
            <td>{{ peca.Modelo }}</td>
            <td>{{ peca.Ano }}</td>
            <td>R$ {{ "%.2f"|format(peca.Preco_Recomendado|float) }}</td>
            <td>{{ peca.Estoque }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>Nenhuma peça encontrada com este prefixo de SKU.</p>
      {% endif %}
      {% endif %}

      {% if pecas_filtradas is defined %}
      <h3>Resultados dos Filtros ({{ pecas_filtradas|length }} peças encontradas)</h3>
      {% if pecas_filtradas %}
      <table>
        <thead>
          <tr>
            <th>SKU</th>
            <th>Peça</th>
            <th>Categoria</th>
            <th>Marca</th>
            <th>Modelo</th>
            <th>Ano</th>
            <th>Preço</th>
            <th>Fornecedor</th>
            <th>Estoque</th>
          </tr>
        </thead>
        <tbody>
          {% for peca in pecas_filtradas %}
          <tr>
            <td>{{ peca.SKU }}</td>
            <td>{{ peca.Nome_Peca }}</td>
            <td>{{ peca.Categoria_Peca }}</td>
            <td>{{ peca.Marca }}</td>
            <td>{{ peca.Modelo }}</td>
            <td>{{ peca.Ano }}</td>
            <td>R$ {{ "%.2f"|format(peca.Preco_Recomendado|float) }}</td>
            <td>{{ peca.Fornecedor }}</td>
            <td>{{ peca.Estoque }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p>Nenhuma peça encontrada com os filtros aplicados.</p>
      {% endif %}
      {% endif %}

    </div>
  </div>
</body>

</html>